/*! jquery Tocify - v0.1.0 - 2012-07-15
* Copyright (c) 2012 Greg Franko; Licensed MIT */
(function(a){"use strict",a(jQuery,window,document)})(function(a,b,c,d){"use strict",a.widget("toc.tocify",{version:"0.1.0",options:{context:"body",selectors:"h1, h2, h3",showEffect:"slideDown",showEffectSpeed:"medium",hideEffect:"slideUp",hideEffectSpeed:"medium",smoothScroll:!0,smoothScrollSpeed:"medium",scrollTo:0,showAndHideOnScroll:!0,highlightOnScroll:!0,highlightOffset:40,jqueryUI:!0,extendPage:!0},_create:function(){this._generateToc(),this._setEventHandlers(),this._addCSSClasses()},_generateToc:function(){var b=this,c,d,e;this.options.selectors.indexOf(",")!==-1?c=a(this.options.context).find(this.options.selectors.replace(/ /g,"").substr(0,this.options.selectors.indexOf(","))):c=a(this.options.context).find(this.options.selectors.replace(/ /g,"")),c.each(function(c){d=a("<ul/>",{id:"Header"+c,"class":"header"}).append(b._nestElements(a(this),c)),b.element.append(d),a(this).nextUntil(this.nodeName.toLowerCase()).filter(b.options.selectors).each(function(c,f){e=a(this).prevAll(b.options.selectors).first(),+a(this)[0].tagName.charAt(1)<+e[0].tagName.charAt(1)?b.element.find(".sub-header").last().after(b._nestElements(a(this),c)):+a(this)[0].tagName.charAt(1)===+e[0].tagName.charAt(1)?d.find(".item").last().after(b._nestElements(a(this),c)):d.find(".item").last().after(a("<ul/>",{"class":"sub-header"})).next(".sub-header").append(b._nestElements(a(this),c))})})},_nestElements:function(b,c){var d=a("<li/>",{text:b.text(),"class":"item","data-href":b.text().replace(/\s/g,""),"data-unique":(b.text()+c).replace(/\s/g,"")});return b.before(a("<div/>",{name:b.text().replace(/\s/g,""),"data-unique":(b.text()+c).replace(/\s/g,"")})),d},_setEventHandlers:function(){var d=this,e,f;this.element.on("click.tocify","li",function(c){b.History&&b.History.pushState(null,a(this).attr("data-href"),"?"+a(this).attr("data-href")),a("."+d.focusClass).removeClass(d.focusClass),a(this).addClass(d.focusClass),b.History||d.show(a(this).closest(".header").find(".sub-header")),e=a(this),d.options.smoothScroll?f=d.options.smoothScrollSpeed:f=0,a("html, body").animate({scrollTop:a('div[data-unique="'+e.attr("data-unique")+'"]').offset().top-d.options.scrollTo+"px"},{duration:f}),d.element.animate({scrollTop:e.offset().top+"px"},{duration:f})}),this.element.find("li").on({"mouseenter.tocify":function(){a(this).addClass(d.hoverClass),a(this).css("cursor","pointer")},"mouseleave.tocify":function(){a(this).removeClass(d.hoverClass)}}),a(b).on("scroll.tocify",function(){a("html, body").promise().done(function(){var e=a(b).scrollTop(),g=a(b).height(),h=a(c).height(),i=a("body")[0].scrollHeight,j,k;d.options.extendPage&&(a.browser.webkit&&e>=i-g||!a.browser.webkit&&g+e===h)&&(d.element.scrollTop(e),a(".tocify-extend-page").length||(k=a('div[data-unique="'+a(".item").last().attr("data-unique")+'"]').offset().top,a(d.options.context).append(a("<div />",{"class":"tocify-extend-page",height:Math.abs(k-e)+"px"})),a("."+d.focusClass).length&&a("html, body").animate({scrollTop:a('div[data-unique="'+a("."+d.focusClass).attr("data-unique")+'"]').offset().top+"px"},{duration:f}))),setTimeout(function(){a(d.options.context).find("div[data-unique]").next().each(function(){if(Math.abs(a(this).offset().top-e)<d.options.highlightOffset)return j=a('li[data-unique="'+a(this).prev("div[data-unique]").attr("data-unique")+'"]'),d.options.highlightOnScroll&&j.length&&(a("."+d.focusClass).removeClass(d.focusClass),j.addClass(d.focusClass)),d.options.showAndHideOnScroll&&(j.parent().hasClass("header")?d.show(j.next(".sub-header")):j.parent().hasClass("sub-header")&&d.show(j.parent())),!1})},0)})}),b.History&&b.History.Adapter.bind(b,"statechange",function(){var c=a('li[data-href="'+b.History.getState().title+'"]');(c.next(".sub-header").length||c.parent().is(".header"))&&d.show(c.next(".sub-header"))})},show:function(b){var c=this;if(!b.is(":visible")){switch(c.options.showEffect){case"none":b.show();break;case"show":b.show(c.options.showEffectSpeed);break;case"slideDown":b.slideDown(c.options.showEffectSpeed);break;case"fadeIn":b.fadeIn(c.options.showEffectSpeed);break;default:b.show()}c.hide(a(".sub-header").not(b.closest(".header").find(".sub-header")))}return this},hide:function(a){var b=this;if(a.is(":visible"))switch(b.options.hideEffect){case"none":a.hide();break;case"hide":a.hide(b.options.hideEffectSpeed);break;case"slideUp":a.slideUp(b.options.hideEffectSpeed);break;case"fadeOut":a.fadeOut(b.options.hideEffectSpeed);break;default:a.hide()}return this},_addCSSClasses:function(){var a=this;return this.options.jqueryUI?(this.focusClass="ui-state-focus",this.hoverClass="ui-state-hover",this.element.addClass("ui-widget").find(".toc-title").addClass("ui-widget-header").end().find("li").addClass("ui-widget-content")):(this.focusClass="tocify-focus",this.hoverClass="tocify-hover"),this}})});